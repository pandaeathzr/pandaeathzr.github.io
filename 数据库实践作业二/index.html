<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.ico" />
    

    <title>
        
          数据库实践作业二资料整合 - Hexo
        
    </title>

    <!-- Spectre.css framework (v0.5.8) -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <!-- Noto Sans SC -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC" rel="stylesheet">
    <!-- Noto Sans -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

    <!-- theme css & js -->
    <link rel="stylesheet" href="/css/spectre_custom.css">
    <link rel="stylesheet" href="/css/book.css">
    <script src="/js/book.js"></script>

    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
</head>

<body>

<div class="container">
  <div class="book-container">
    <div class="columns">
      <div class="column col-2 hide-lg">
        <div class="book-sidebar">
  <h4 class="site-meta">
    <a href="/">Hexo</a>
  </h4>
  <div class="sidebar-content">
    
  </div>
</div>

<script src="/js/book-sidebar.js"></script>
      </div>

      <div class="column col-8 col-lg-12">
        <div class="book-content">
          <div class="book-navbar">
  <header class="navbar">
  <section class="navbar-section">
    <img class="navbar-icon" src="/favicon.ico">
  </section>
  <section class="navbar-center">
    Hexo
  </section>
  <section class="navbar-section">
    <label class="accordion-header c-hand" for="accordion-sidebar">
      <i class="icon icon-menu"></i>
    </label>
  </section>
</header>

<div class="accordion">
  <input type="checkbox" id="accordion-sidebar" name="accordion-checkbox" hidden>
  <div class="accordion-body">
    
  </div>
</div>
</div>

<div class="book-post">
  <p>根据实验课的题目要求，共需要掌握以下部分：</p>
<ul>
<li>用户及用户权限管理</li>
<li>存储及触发器使用</li>
<li>数据库的备份与恢复</li>
</ul>
<p>以下部分将是很基础的数据库操作，存在许多不足需要改正。</p>
<hr>
<h2 id="用户及用户权限管理"><a href="#用户及用户权限管理" class="headerlink" title="用户及用户权限管理"></a>用户及用户权限管理</h2><p><strong>前提：熟悉课本第四章内容</strong></p>
<p>我们在ROOT用户下<strong>创建普通用户</strong>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> HUZR@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">by</span> <span class="string">'123'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> pig@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">by</span> <span class="string">'123'</span>;</span><br></pre></td></tr></table></figure>
<p> 然后我们可以在Nvaicat for MySQL客户端用户界面看到我们所创建的用户：<br><img src="https://i.imgur.com/a0TJUwn.jpg" alt=""></p>
<p>接着可以对<strong>用户授权</strong><br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> student</span><br><span class="line"><span class="keyword">TO</span> HUZR@localhost;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> course</span><br><span class="line"><span class="keyword">TO</span> pig@localhost;</span><br></pre></td></tr></table></figure></p>
<p>则我们刚才得到的用户分别有了对student、course表查询的权限</p>
<p>那么我们如何登陆我们新建的用户呢？</p>
<p>在Nvaicat for MySQL客户端新建一个连接：</p>
<p><img src="https://i.imgur.com/1djcpPJ.jpg" alt=""></p>
<p>其中用户名和密码为我们刚才设定的内容。</p>
<p>由于Nvaicat for MySQL客户端密码编码版本与MySQL服务器不同的原因。我们还需要更新该用户在MySQL服务器下的密码及解锁该用户 <a href="https://www.cnblogs.com/Huzr/p/9005188.html" target="_blank" rel="noopener">详情见链接</a></p>
<p>此后我们用新增用户登陆，可以发现里面存在被我们赋予查询权限的表</p>
<p><img src="https://i.imgur.com/XlLXajM.jpg" alt=""></p>
<p><strong>回收权限</strong><br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">TABLE</span> student</span><br><span class="line"><span class="keyword">FROM</span> HUZR@localhost;</span><br></pre></td></tr></table></figure></p>
<p>经过此操作后在新建用户的数据库中已经没有相应的表格存在</p>
<p>至此第一部分的基础内容已经完成。</p>
<hr>
<h2 id="存储及触发器的使用"><a href="#存储及触发器的使用" class="headerlink" title="存储及触发器的使用"></a>存储及触发器的使用</h2><p>存储相当于对一个函数的封装，<strong>创建存储</strong>如下：<br><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">delimiter $  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">select_row</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">BEGIN</span></span></span><br><span class="line"><span class="function">	<span class="title">SELECT</span> * <span class="title">FROM</span> <span class="title">student</span> <span class="title">WHERE</span> <span class="title">sname</span> = '   ';</span></span><br><span class="line">true<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> course ;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure></p>
<p>对以上代码进行解析：</p>
<ul>
<li>MySQL默认以”;”为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER $”声明当前段分隔符，让编译器把两个”$”之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</li>
<li>CREATE PROCEDURE 后面接的是存储的name（可以理解为函数的名称,可带参数，此处不展开），例子中即为selcet_row()</li>
<li>BEGIN 到 EDN 中间为存储的sql语句，可以花样百出</li>
</ul>
<p><strong>存储调用</strong></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CALL</span> select_row<span class="comment">()</span>;</span><br></pre></td></tr></table></figure>
<p>注意尽管没有参数，也需要带上括号</p>
<p><strong>查看存储</strong><br><figure class="highlight cal"><table><tr><td class="code"><pre><span class="line">show <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">STATUS</span> <span class="title">WHERE</span> <span class="title">Db</span> = '031602215';</span></span><br></pre></td></tr></table></figure></p>
<p><strong>删除存储</strong><br><figure class="highlight cal"><table><tr><td class="code"><pre><span class="line">DROP <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">select_row</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>详尽资料链接见下：</p>
<p><a href="https://www.cnblogs.com/mark-chan/p/5384139.html" target="_blank" rel="noopener">https://www.cnblogs.com/mark-chan/p/5384139.html</a></p>
<p><a href="https://www.cnblogs.com/geaozhang/p/6797357.html" target="_blank" rel="noopener">https://www.cnblogs.com/geaozhang/p/6797357.html</a></p>
<hr>
<p>触发器顾名思义，<strong>创建触发器</strong>如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> inset_student</span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> xuandao <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">true<span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">'这里是触发器'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>对以上面代码解析：</p>
<ul>
<li>CREATE TRIGGER 后面接的的触发器名称</li>
<li>AFTER UPDATE 表明在更新操作后触发，其中AFTER的另一个参数为BEFORE; UPDATE亦可改成 INSERT,DELETE</li>
<li>ON 后面接表的名称，说明在哪张表建立触发器</li>
<li>FOR EACH ROW 说明是行级触发器，似乎没啥作用</li>
<li>BEGIN END 里面为触发执行的语句</li>
</ul>
<p><strong>注意，不能对同一张表同时触发又执行</strong> ,否则会报错</p>
<p><strong>查看触发器</strong><br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGERS</span>;</span><br></pre></td></tr></table></figure></p>
<p><strong>查看触发器效果</strong><br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> xuandao</span><br><span class="line"><span class="keyword">SET</span> tc = <span class="string">'   '</span></span><br><span class="line"><span class="keyword">WHERE</span> sname = <span class="string">'   '</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure></p>
<p>通过对xuandao表格的更新，然后通过select查看效果</p>
<p><strong>删除触发器</strong></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> inset_student;</span><br></pre></td></tr></table></figure>
<p>详尽资料链接见下：</p>
<p><a href="https://www.cnblogs.com/CraryPrimitiveMan/p/4206942.html" target="_blank" rel="noopener">https://www.cnblogs.com/CraryPrimitiveMan/p/4206942.html</a></p>
<hr>
<h2 id="数据库的备份与恢复"><a href="#数据库的备份与恢复" class="headerlink" title="数据库的备份与恢复"></a>数据库的备份与恢复</h2><p><strong>完整备份：</strong></p>
<p>mysqldump -u root -p database_name &gt; 路径及备份文件名.sql</p>
<p><strong>差异备份：</strong></p>
<p>在windows下我还不会。。。。</p>
<p>日志备份：</p>
<p>同上。。。</p>
<p><strong>备份恢复：</strong></p>
<p><code>source yourbf.sql</code></p>
<hr>
<p>前面所讲的内容都只是一个框架，可以精致的展开。</p>
<p>在windows下的MySQL真是难受，找了两天的教程还是没解决，各种教程都是Linux情况的。</p>

</div>


  <div class="book-comments">
    


  </div>


<script src="/js/book-post.js"></script>
        </div>
      </div>

      <div class="column col-2 hide-lg">
        <div class="book-toc">
  <div class="book-tocbot">
  </div>
  <div class="book-tocbot-menu">
    <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
    <a onclick="go_top()">Back to top</a>
    <a onclick="go_bottom()">Go to bottom</a>
  </div>
</div>

<script>
tocbot.init({
  tocSelector: '.book-tocbot',
  contentSelector: '.book-post',
  headingSelector: 'h1, h2, h3, h4, h5',
  collapseDepth: 2,
  orderedList: false,
  scrollSmooth: false,
});

function expand_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 6,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "collapse_toc()");
  b.innerHTML = "Collapse all"
}

function collapse_toc(){
  var b = document.querySelector(".book-toc-expand");
  tocbot.init({
    tocSelector: '.book-tocbot',
    contentSelector: '.book-post',
    headingSelector: 'h1, h2, h3, h4, h5',
    collapseDepth: 2,
    orderedList: false,
    scrollSmooth: false,
  });
  b.setAttribute("onclick", "expand_toc()");
  b.innerHTML = "Expand all"
}

function go_top() {
  window.scrollTo(0, 0);
}

function go_bottom() {
  window.scrollTo(0, document.body.scrollHeight);
}

</script>
      </div>
    </div>
  </div>
</div>

</body>
</html>
